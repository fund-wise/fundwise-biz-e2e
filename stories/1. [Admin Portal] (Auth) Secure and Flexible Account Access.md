Fundwise: Secure and Flexible Account Access
This document outlines the complete user experience for a new or returning user, Maria, as she authenticates with the Fundwise platform. It covers the traditional email/password method, the convenience of social logins, and the security of password recovery.

Epic: Secure and Flexible Account Access
User Persona: Maria, a new or returning user of the Fundwise platform. She expects modern, convenient login options but also requires a secure way to recover her account if she forgets her password.

Narrative: As a user, I want flexible and secure ways to access my account. I want the choice to sign up with a traditional email and password or to use my existing Google account for a faster experience. When I return, I expect a seamless login process, and if I forget my password, I need a reliable way to reset it.

#### 1. The Google Sign-Up Choice

* **As** a new user, Maria, I want to sign up using my Google account, so I can save time on registration and not have to remember another new password.

**The Experience:**
On the "Sign Up" page, Maria sees a prominent button: **"Sign Up with Google."** She clicks it. A familiar Google pop-up window appears, asking her to choose her Google account and grant Fundwise permission to view her name and email address. She approves, the pop-up closes, and she is instantly redirected to her new Fundwise dashboard.


#### 2. The Google Login Choice

* **As** a returning user, Maria, I want to log in with a single click using my Google account, so I can access my dashboard as quickly as possible.

**The Experience:**
On the "Log In" page, Maria clicks the **"Sign In with Google"** button. She selects her account from the Google pop-up and is immediately taken to her dashboard, with no typing required.


#### 3. The Forgotten Password Scenario

* **As** Maria, having signed up with an email and password, I've forgotten my password and need a secure way to regain access to my account.

**The Experience:**
On the "Log In" page, Maria clicks the **"Forgot Password?"** link. This takes her to a simple page asking for the email address associated with her Fundwise account.

**Implementation Details:**
* **UI/UX:** A simple form that collects the user's email. For security, the page gives a generic response ("If an account with that email exists...") whether the email is found or not, to prevent user enumeration.


#### 4. The Secure Reset Process

* **As** Maria, after requesting a password reset, I want to receive a secure, time-sensitive link via email that allows me to set a new password.

**The Experience:**
After submitting her email, Maria sees a message: "If an account with that email exists, we have sent instructions to reset your password." She checks her inbox and finds an email from Fundwise with a unique reset link. Clicking it opens a new page, prompting her to enter and confirm a new password.

**Implementation Details:**
* **Token Generation:** The backend generates a secure, single-use, time-limited token (e.g., valid for 1 hour).
* **Database:** This token is stored in a `Password_Resets` table, linked to Maria's `user_id` and an `expires_at` timestamp.
* **Verification:** When the link is clicked, the backend validates the token from the URL. It checks if the token exists, has not expired, and has not been used before.


#### 5. Confirmation and Re-authentication

* **As** Maria, after setting a new password, I want confirmation that the change was successful and my account is secure.

**The Experience:**
Once she submits her new password, she is redirected to the login page with a success message: **"Your password has been successfully reset. Please log in with your new password."** She also receives a security notification email confirming the password change. She can now log in using her email and her newly created password.

**Implementation Details:**
* **Database Update:** The new password is securely hashed. The `password_hash` field in the `Users` table is updated with the new hash. The token in the `Password_Resets` table is invalidated or deleted to prevent reuse.
* **User Feedback:** The success message and security email provide immediate and clear feedback, closing the loop on the process and reinforcing trust.


#### 6. The Traditional Sign-Up Choice

* **As** a new user, Maria, I want to sign up by creating a new password for my email address, so I can keep my accounts separate and maintain direct control over my login credentials.

**The Experience:**
On the "Sign Up" page, Maria opts to use the standard form. She enters her first name, last name, email address, and chooses a new, strong password, guided by a password strength indicator. After clicking "Create Account," she receives an email asking her to verify her email address. She clicks the link in the email, which confirms her account and logs her into her new Fundwise dashboard.

**Implementation Details:**
* **Frontend:** A standard registration form with client-side validation for email format and password strength.
* **Backend:** Upon submission, the backend hashes the password using a strong, one-way algorithm (e.g., bcrypt).
* **Database:** A new record is created in the `Users` table with `first_name`, `last_name`, `email`, and the generated `password_hash`. An `is_email_verified` boolean field is set to `false`. A separate `Email_Verifications` table stores a unique, single-use token linked to her `user_id`.
* **Workflow:** An email is sent with a link containing the verification token. When clicked, a backend endpoint validates the token, updates `is_email_verified` to `true`, and invalidates the token.


#### 7. The Traditional Login Choice

* **As** a returning user, Maria, I want to log in by entering my email and password, so I can securely access my account.

**The Experience:**
Maria returns to the "Log In" page. She enters the email and password she created during sign-up and clicks "Log In." The credentials are validated, and she is securely redirected to her dashboard. If she enters the wrong password, she receives a generic error message ("Invalid email or password") for security.

**Implementation Details:**
* **Backend Logic:** The backend finds the user by email, retrieves the stored `password_hash`, and uses a secure comparison function (like `bcrypt.compare`) to check if the provided password matches the hash. It never decrypts the stored hash.
